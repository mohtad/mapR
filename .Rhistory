mer_long=as.numeric(x['mer_long']);
mercator(c(mer_long,mer_lat),TRUE)
})
library("geosphere", lib.loc="~/R/win-library/3.3")
longlat = apply(boundaries_i,1,function(x){
mer_lat=as.numeric(x['mer_lat']);
mer_long=as.numeric(x['mer_long']);
mercator(c(mer_long,mer_lat),TRUE)
})
boundaries_i$long = longlat[1,]
boundaries_i$lat = longlat[2,]
rm(longlat)
if(!is.null(map_center)){
boundaries_i$dist_to_center = apply(boundaries_i,1,function(x){
lat=as.numeric(x['lat']);
long=as.numeric(x['long']);
distm (c(map_center$long, map_center$lat), c(long,lat), fun = distHaversine)*0.000621371;
})
}
return (boundaries_i)
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
boundaries_coords<-NULL
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
View(boundaries_coords)
names(fsa_coords)[names(fsa_coords)=="latitude"] <- "lat"
names(fsa_coords)[names(fsa_coords)=="longitude"] <- "long"
fsa_coords =dbGetQuery(conn,"select postal_zip3_fsa as id, latitude, longitude
from
plivevw.postal_data_master ma
left join plivevw.postal_census_data ce on ma.ctry_nm = ce.ctry_nm and ma.postal_cd= ce.postal_cd
where ma.ctry_nm='CA'
QUALIFY ROW_NUMBER() OVER(PARTITION BY ma.postal_zip3_fsa ORDER BY ce.pop_size DESC)=1	--  dedupe records
;
")
drv = JDBC("com.teradata.jdbc.TeraDriver","C:\\dev\\apache-tomcat-7.0.56\\lib\\terajdbc4.jar;C:\\dev\\apache-tomcat-7.0.56\\lib\\tdgssconfig.jar")
conn = dbConnect(drv,"jdbc:teradata://tdprd.dw.bizsys.tmcs","mnadjar","mnadjar")
fsa_coords =dbGetQuery(conn,"select postal_zip3_fsa as id, latitude, longitude
from
plivevw.postal_data_master ma
left join plivevw.postal_census_data ce on ma.ctry_nm = ce.ctry_nm and ma.postal_cd= ce.postal_cd
where ma.ctry_nm='CA'
QUALIFY ROW_NUMBER() OVER(PARTITION BY ma.postal_zip3_fsa ORDER BY ce.pop_size DESC)=1	--  dedupe records
;
")
names(fsa_coords)[names(fsa_coords)=="latitude"] <- "lat"
names(fsa_coords)[names(fsa_coords)=="longitude"] <- "long"
boundaries_coords<-boundaries_coords.shape(fsa_coords, map_center)
View(boundaries_coords)
View(shape_boundaries)
View(fsa_coords)
View(fsa_coords)
boundaries_coords<-boundaries_coords.shape(fsa_coords, map_center)
max(fsa_coords$lat)
min(fsa_coords$lat)
max(boundaries_coords$lat)
boundaries_i<-fsa_coords
mer = apply(boundaries_i,1,function(x){
lat=as.numeric(x['lat']);
long=as.numeric(x['long']);
mer<-mercator(c(long,lat))
})
boundaries_i$mer_lat = mer[2,]
boundaries_i$mer_long = mer[1,]
rm(mer)
if(!is.null(map_center)){
boundaries_i$dist_to_center = apply(boundaries_i,1,function(x){
lat=as.numeric(x['lat']);
long=as.numeric(x['long']);
distm (c(map_center$long, map_center$lat), c(long,lat), fun = distHaversine)*0.000621371;
})
}
boundaries_coords<-boundaries_coords.df(fsa_coords, map_center)
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
library(mapR)
library(RJDBC)
library(RODBC)
drv = JDBC("com.teradata.jdbc.TeraDriver","C:\\dev\\apache-tomcat-7.0.56\\lib\\terajdbc4.jar;C:\\dev\\apache-tomcat-7.0.56\\lib\\tdgssconfig.jar")
conn = dbConnect(drv,"jdbc:teradata://tdprd.dw.bizsys.tmcs","mnadjar","mnadjar")
BAA_data =dbGetQuery(conn,"select FSA,penetration_pct, customer_cnt
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(BAA_data)[names(BAA_data)=="FSA"] <- "id"
map_center =dbGetQuery(conn,"SELECT DISTINCT ven_longitude as lon,
ven_latitude as lat
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(map_center)[names(map_center)=="lon"] <- "long"
fsa_coords =dbGetQuery(conn,"select postal_zip3_fsa as id, latitude, longitude
from
plivevw.postal_data_master ma
left join plivevw.postal_census_data ce on ma.ctry_nm = ce.ctry_nm and ma.postal_cd= ce.postal_cd
where ma.ctry_nm='CA'
QUALIFY ROW_NUMBER() OVER(PARTITION BY ma.postal_zip3_fsa ORDER BY ce.pop_size DESC)=1	--  dedupe records
;
")
names(fsa_coords)[names(fsa_coords)=="latitude"] <- "lat"
names(fsa_coords)[names(fsa_coords)=="longitude"] <- "long"
# the location of the venue
locations = data.frame(name=c("CANADIAN TIRE CENTRE"), long = c(-75.925902), lat = c(45.296034) )
# project in mercator axis system
#locations$mer_long = mercator(c(locations$long,locations$lat))[1]
#locations$mer_lat = mercator(c(locations$long,locations$lat))[2]
#
#map_center = data.frame(long = c(-94.823686), lat = c(39.121296) )
#
#Compute zip 'distance to' venue
#
#Bal_BAA_data$bin <- add_bins(Bal_BAA_data,"All_Subscribers_2016", br=c(-1,0,10,35,61,92,122), lab=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122"))
BAA_data$bin <- add_bins(BAA_data,"customer_cnt")
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
#spacial_object = readOGR(dsn=shape_boundaries_dir,layer=shape_boundaries_filename)
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
shape_roads<-shape_roads(shape_roads_dir, shape_roads_filename)
#us_zcta_path = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/zcta_coordinates/2015_Gaz_zcta_national.txt"
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
boundaries_coords<-boundaries_coords.df(fsa_coords, map_center)
dist_center<-25
legend_title<-'Number of Customers'
zoom<-10
color_bins<-c("#ececec","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177")
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
p
?paste
?mercator
?c
?structure
?lm
?list
bs = list(br=NULL, lab=NULL)
bs$br
bs = NULL
bs$br
bs
bins=NULL
?bins
BAA_data["customer_cnt"]
library(RJDBC)
library(RODBC)
drv = JDBC("com.teradata.jdbc.TeraDriver","C:\\dev\\apache-tomcat-7.0.56\\lib\\terajdbc4.jar;C:\\dev\\apache-tomcat-7.0.56\\lib\\tdgssconfig.jar")
conn = dbConnect(drv,"jdbc:teradata://tdprd.dw.bizsys.tmcs","mnadjar","mnadjar")
BAA_data =dbGetQuery(conn,"select FSA,penetration_pct, customer_cnt
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(BAA_data)[names(BAA_data)=="FSA"] <- "id"
map_center =dbGetQuery(conn,"SELECT DISTINCT ven_longitude as lon,
ven_latitude as lat
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(map_center)[names(map_center)=="lon"] <- "long"
BAA_data["customer_cnt"]
BAA_data["customer_cnt"][,1]
?typeof(BAA_data["customer_cnt"])
typeof(BAA_data["customer_cnt"])
typeof(BAA_data["customer_cnt"][,1])
typeof(BAA_data$customer_cnt)
?data.frame
x <- floor(exp(rnorm(200000 * 1.3)))
min(x)
max(x)
data<-data.frame(x =floor(exp(rnorm(200000 * 1.3))))
data$bin <- add_bins(data$x, nbins=6)
library(mapR)
data$bin <- add_bins(data$x, nbins=6)
data$bin <- create_bins(data$x, nbins=6)
?is.null
library(mapR)
data$bin <- create_bins(data$x, nbins=6)
View(data)
library(mapR)
data<-data.frame(x =floor(exp(rnorm(200000 * 1.3))))
data$bin <- add_bins(data$x, nbins=NULL, bins=list(breaks=c(-1,0,1,35,61,92,130), labels=c("0","1","2 to 35","36 to 61","62 to 92","93 to 130")))
data$bin <- create_bins(data$x, nbins=NULL, bins=list(breaks=c(-1,0,1,35,61,92,130), labels=c("0","1","2 to 35","36 to 61","62 to 92","93 to 130")))
View(data)
library(mapR)
data$bin <- create_bins(data$x, nbins=NULL, bins=list(breaks=c(-1,0,1,35,61,92,130), labels=c("0","1","2 to 35","36 to 61","62 to 92","93 to 130")))
data<-data.frame(x =floor(exp(rnorm(200000 * 1.3))))
data$bin <- create_bins(data$x, nbins=NULL, bins=list(breaks=c(-1,0,1,35,61,92,130), labels=c("0","1","2 to 35","36 to 61","62 to 92","93 to 130")))
View(data)
data<-data.frame(x =floor(exp(rnorm(200000 * 1.3))))
data$bin <- create_bins(data$x, nbins=6)
View(data)
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
data = data.frame(long = c(-94.823686, -94), lat = c(39.121296, 39) )
map_center = data.frame(long = c(-94.823686), lat = c(39.121296) )
boundaries_coords<-boundaries_coords.df(data, map_center)
View(boundaries_coords)
library(mapR)
library(mapR)
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
library("rgdal", lib.loc="~/R/win-library/3.3")
pacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object <- spTransform(spacial_object, osm())
library("OpenStreetMap", lib.loc="~/R/win-library/3.3")
library("broom", lib.loc="~/R/win-library/3.3")
spacial_object <- spTransform(spacial_object, osm())
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/roads/tl_2016_us_primaryroads"
shape_roads_filename = "tl_2016_us_primaryroads"
spacial_object1 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object1 <- spTransform(spacial_object, osm())
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
spacial_object2 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object2 <- spTransform(spacial_object, osm())
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
spacial_object2 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object2 <- spTransform(spacial_object2, osm())
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/roads/tl_2016_us_primaryroads"
shape_roads_filename = "tl_2016_us_primaryroads"
spacial_object1 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object1 <- spTransform(spacial_object1, osm())
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
spacial_object2 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object2 <- spTransform(spacial_object2, osm())
?tidy
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
shape_roads<-shape_roads(shape_roads_dir, shape_roads_filename)
#us_zcta_path = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/zcta_coordinates/2015_Gaz_zcta_national.txt"
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
boundaries_coords<-boundaries_coords.df(fsa_coords, map_center)
dist_center<-25
legend_title<-'Number of Customers'
zoom<-10
color_bins<-c("#ececec","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177")
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
drv = JDBC("com.teradata.jdbc.TeraDriver","C:\\dev\\apache-tomcat-7.0.56\\lib\\terajdbc4.jar;C:\\dev\\apache-tomcat-7.0.56\\lib\\tdgssconfig.jar")
conn = dbConnect(drv,"jdbc:teradata://tdprd.dw.bizsys.tmcs","mnadjar","mnadjar")
BAA_data =dbGetQuery(conn,"select FSA,penetration_pct, customer_cnt
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(BAA_data)[names(BAA_data)=="FSA"] <- "id"
map_center =dbGetQuery(conn,"SELECT DISTINCT ven_longitude as lon,
ven_latitude as lat
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(map_center)[names(map_center)=="lon"] <- "long"
fsa_coords =dbGetQuery(conn,"select postal_zip3_fsa as id, latitude, longitude
from
plivevw.postal_data_master ma
left join plivevw.postal_census_data ce on ma.ctry_nm = ce.ctry_nm and ma.postal_cd= ce.postal_cd
where ma.ctry_nm='CA'
QUALIFY ROW_NUMBER() OVER(PARTITION BY ma.postal_zip3_fsa ORDER BY ce.pop_size DESC)=1	--  dedupe records
;
")
names(fsa_coords)[names(fsa_coords)=="latitude"] <- "lat"
names(fsa_coords)[names(fsa_coords)=="longitude"] <- "long"
# the location of the venue
locations = data.frame(name=c("CANADIAN TIRE CENTRE"), long = c(-75.925902), lat = c(45.296034) )
# project in mercator axis system
#locations$mer_long = mercator(c(locations$long,locations$lat))[1]
#locations$mer_lat = mercator(c(locations$long,locations$lat))[2]
#
#map_center = data.frame(long = c(-94.823686), lat = c(39.121296) )
#
#Compute zip 'distance to' venue
#
#Bal_BAA_data$bin <- add_bins(Bal_BAA_data,"All_Subscribers_2016", br=c(-1,0,10,35,61,92,122), lab=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122"))
BAA_data$bin <- add_bins(BAA_data,"customer_cnt")
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
#spacial_object = readOGR(dsn=shape_boundaries_dir,layer=shape_boundaries_filename)
# https://catalog.data.gov/dataset/usgs-small-scale-dataset-north-american-atlas-roads-200406-shapefile
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
shape_roads<-shape_roads(shape_roads_dir, shape_roads_filename)
#us_zcta_path = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/zcta_coordinates/2015_Gaz_zcta_national.txt"
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
boundaries_coords<-boundaries_coords.df(fsa_coords, map_center)
dist_center<-25
legend_title<-'Number of Customers'
zoom<-10
color_bins<-c("#ececec","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177")
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
BAA_data$bin <- create_bins(BAA_data,"customer_cnt")
BAA_data$bin <- create_bins(BAA_data$customer_cnt,nbins=6)
color_bins
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
View(shape_boundaries)
shape_boundaries2<-shape_boundaries(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object <- spTransform(spacial_object, osm())
spacial_object.df <- tidy(spacial_object) #fortify
spacial_object.df <- tidy(spacial_object,'ROAD_L_') #fortify
spacial_object = readOGR(shape_boundaries_dir,shape_boundaries_filename)
spacial_object <- spTransform(spacial_object, osm())#we need to use a mercator projection: osm()
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object <- spTransform(spacial_object, osm())
spacial_object.df <- tidy(spacial_object,region='ROAD_L_') #fortify
max(spacial_object.df$id)
?unique
toto = unique(spacial_object.df$id)
spacial_object2 = readOGR(shape_boundaries_dir,shape_boundaries_filename)
spacial_object2 <- spTransform(spacial_object2, osm())#we need to use a mercator projection: osm()
?tidy
toto = tidy
toto = rownames(spacial_object@data)
toto = spacial_object@data$ROAD_L_
spacial_object@data$id <-rownames(spacial_object@data)
spacial_object.df <- tidy(spacial_object)
spacial_object.df <- merge(spacial_object.df, spacial_object@data, by="id")
View(spacial_object.df)
library(mapR)
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
spacial_object = readOGR(shape_boundaries_dir,shape_boundaries_filename)
spacial_object <- spTransform(spacial_object, osm())#we need to use a mercator projection: osm()
library("rgdal", lib.loc="~/R/win-library/3.3")
library("broom", lib.loc="~/R/win-library/3.3")
library("OpenStreetMap", lib.loc="~/R/win-library/3.3")
spacial_object = readOGR(shape_boundaries_dir,shape_boundaries_filename)
spacial_object <- spTransform(spacial_object, osm())#we need to use a mercator projection: osm()
spacial_object2 <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object2 <- spTransform(spacial_object2, osm())
spacial_object.df <- tidy(spacial_object)
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object <- spTransform(spacial_object, osm())
spacial_object@data$id <-rownames(spacial_object@data)
spacial_object.df <- tidy(spacial_object)#,region='ROAD_L_') #fortify
spacial_object.df <- merge(spacial_object.df, spacial_object@data, by="id")
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
spacial_object <- readOGR(shape_boundaries_dir,shape_boundaries_filename)
spacial_object <- spTransform(spacial_object, osm())
spacial_object@data$id <-rownames(spacial_object@data)
spacial_object.df <- tidy(spacial_object)#,region='ROAD_L_') #fortify
spacial_object.df <- merge(spacial_object.df, spacial_object@data, by="id")
spacial_object.df <- tidy(spacial_object, region="CFSAUID") #fortify
spacial_object.df <- merge(spacial_object.df, spacial_object@data, by="id")
toto = spacial_object@data
View(toto)
spacial_object <- readOGR(shape_roads_dir,shape_roads_filename)
spacial_object <- spTransform(spacial_object, osm())
toto = spacial_object@data
View(toto)
?tidy
?sp
library(mapR)
library(mapR)
shape_boundaries_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/canada/2011_Census_Boundary_files/Forward_sortation_areas/cartographic_boundary_file"
shape_boundaries_filename = "gfsa000b11a_e"
boundary_identifier = "CFSAUID"
shape_boundaries<-shapefile_dataframe(shape_boundaries_dir, shape_boundaries_filename,boundary_identifier)
#spacial_object = readOGR(dsn=shape_boundaries_dir,layer=shape_boundaries_filename)
# https://catalog.data.gov/dataset/usgs-small-scale-dataset-north-american-atlas-roads-200406-shapefile
shape_roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/North_American_Atlas/Roads_200406"
shape_roads_filename = "road_l"
boundary_identifier = "ROAD_L_"
shape_roads<-shapefile_dataframe(shape_roads_dir, shape_roads_filename,boundary_identifier)
library(RJDBC)
library(RODBC)
drv = JDBC("com.teradata.jdbc.TeraDriver","C:\\dev\\apache-tomcat-7.0.56\\lib\\terajdbc4.jar;C:\\dev\\apache-tomcat-7.0.56\\lib\\tdgssconfig.jar")
conn = dbConnect(drv,"jdbc:teradata://tdprd.dw.bizsys.tmcs","mnadjar","mnadjar")
BAA_data =dbGetQuery(conn,"select FSA,penetration_pct, customer_cnt
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(BAA_data)[names(BAA_data)=="FSA"] <- "id"
map_center =dbGetQuery(conn,"SELECT DISTINCT ven_longitude as lon,
ven_latitude as lat
FROM tlieu.feld_canada_fsa_report
where brand_engage_seq_id = 'DisneyIce-19-1026672351- 131188'
;
")
names(map_center)[names(map_center)=="lon"] <- "long"
fsa_coords =dbGetQuery(conn,"select postal_zip3_fsa as id, latitude, longitude
from
plivevw.postal_data_master ma
left join plivevw.postal_census_data ce on ma.ctry_nm = ce.ctry_nm and ma.postal_cd= ce.postal_cd
where ma.ctry_nm='CA'
QUALIFY ROW_NUMBER() OVER(PARTITION BY ma.postal_zip3_fsa ORDER BY ce.pop_size DESC)=1	--  dedupe records
;
")
names(fsa_coords)[names(fsa_coords)=="latitude"] <- "lat"
names(fsa_coords)[names(fsa_coords)=="longitude"] <- "long"
# the location of the venue
locations = data.frame(name=c("CANADIAN TIRE CENTRE"), long = c(-75.925902), lat = c(45.296034) )
# project in mercator axis system
#locations$mer_long = mercator(c(locations$long,locations$lat))[1]
#locations$mer_lat = mercator(c(locations$long,locations$lat))[2]
#
#map_center = data.frame(long = c(-94.823686), lat = c(39.121296) )
#
#Compute zip 'distance to' venue
#
#Bal_BAA_data$bin <- add_bins(Bal_BAA_data,"All_Subscribers_2016", br=c(-1,0,10,35,61,92,122), lab=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122"))
BAA_data$bin <- create_bins(BAA_data$customer_cnt,nbins=6)
dist_center<-25
legend_title<-'Number of Customers'
zoom<-10
color_bins<-c("#ececec","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177")
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
boundaries_coords<-boundaries_coords.shape(shape_boundaries, map_center)
boundaries_coords<-boundaries_coords.df(fsa_coords, map_center)
color_bins<-c("#ececec","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177")
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
p
locations = data.frame(name=c("Children's Mercy Park", "toto", "toto2", "toto3"), long = c(-94.823686, -94.823686, -94.823686, -94.823686), lat = c(39.121296,39.121296,39.121296,39.121296) )
Bal_BAA_data$bin <- add_bins(Bal_BAA_data,"All_Subscribers_2016", br=c(-1,0,10,35,61,92,122), lab=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122"))
Bal_BAA_data$bin <- create_bins(Bal_BAA_data,"All_Subscribers_2016", br=c(-1,0,10,35,61,92,122), lab=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122"))
Bal_BAA_data$bin <- create_bins(Bal_BAA_data,"All_Subscribers_2016", br=bins=list(breaks=c(-1,0,10,35,61,92,122), labels=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122")))
Bal_BAA_data$bin <- create_bins(Bal_BAA_data,"All_Subscribers_2016", bins=list(breaks=c(-1,0,10,35,61,92,122), labels=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122")))
Bal_BAA_data =dbGetQuery(conn,"SELECT
zipcode,
FS_2016_all 	AS All_Subscribers_2016,
FS_2016_new   AS New_Subscribers_2016,
FS_2016_renew   AS Renewed_Subscribers_2016,
FS_2016_lapsed AS Lapsed_Subscribers_2016,
SINGLE_2015_all AS Single_Buyers_2015
FROM plasb.baa2_2016_zip_report
WHERE market_id =4 --(4,5,11, 22, 30)  -- Baltimore, Boston, Fl Lauderdale, Orlando, Tempe
ORDER BY market_nm, zipcode
;
")
map_center =dbGetQuery(conn,"SELECT DISTINCT
venue_longitude as lon,
venue_latitude as lat
FROM plasb.baa2_2016_zip_report
WHERE market_id =4
;
")
names(map_center)[names(map_center)=="lon"] <- "long"
locations = data.frame(name=c("Children's Mercy Park", "toto", "toto2", "toto3"), long = c(-94.823686, -94.823686, -94.823686, -94.823686), lat = c(39.121296,39.121296,39.121296,39.121296) )
Bal_BAA_data$bin <- create_bins(Bal_BAA_data,"All_Subscribers_2016", bins=list(breaks=c(-1,0,10,35,61,92,122), labels=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122")))
source('~/heatmapR/Template_heatmapR_step2_20161205.R')
Bal_BAA_data$bin <- create_bins(Bal_BAA_data$All_Subscribers_2016, bins=list(breaks=c(-1,0,10,35,61,92,122), labels=c("0","1 to 10","11 to 35","36 to 61","62 to 92","93 to 122")))
shape_us_zcta_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/zcta/cb_2015_us_zcta510_500k"
shape_us_zcta_filename = "cb_2015_us_zcta510_500k"
boundary_identifier = "id"
spacial_object <- readOGR(shape_us_zcta_dir,shape_us_zcta_filename)
spacial_object <- spTransform(spacial_object, osm())
Shape_US_Roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/roads/tl_2016_us_primaryroads"
Shape_US_Roads_filename = "tl_2016_us_primaryroads"
spacial_object <- readOGR(Shape_US_Roads_dir,Shape_US_Roads_filename)
spacial_object <- spTransform(spacial_object, osm())
shape_us_zcta_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/zcta/cb_2015_us_zcta510_500k"
shape_us_zcta_filename = "cb_2015_us_zcta510_500k"
boundary_identifier = "ZCTA5CE10"
shape_roads<-shapefile_dataframe(shape_us_zcta_dir, shape_us_zcta_filename,boundary_identifier)
Shape_US_Roads_dir = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/shape/us/roads/tl_2016_us_primaryroads"
Shape_US_Roads_filename = "tl_2016_us_primaryroads"
boundary_identifier = "FULLNAME"
shape_us_roads<-shapefile_dataframe(Shape_US_Roads_dir, Shape_US_Roads_filename,boundary_identifier)
source('~/heatmapR/Template_heatmapR_step2_20161205.R')
shape_zcta<-shape_roads
Bal_zipcodes<- read.csv(us_zcta_path, sep = "")
us_zcta_path = "C:/Users/Mohtadi.Nadjar/heatmapR/Template/zcta_coordinates/2015_Gaz_zcta_national.txt"
Bal_zipcodes<- read.csv(us_zcta_path, sep = "")
Bal_zipcodes<- read.csv(us_zcta_path, sep = "", colClasses=c("GEOID"="character"))
names(Bal_zipcodes)[names(Bal_zipcodes)=="INTPTLONG"] <- "long"
names(Bal_zipcodes)[names(Bal_zipcodes)=="INTPTLAT"] <- "lat"
names(Bal_zipcodes)[names(Bal_zipcodes)=="GEOID"] <- "id"
zcta<-boundaries_coords.df(Bal_zipcodes, map_center)
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_roads=shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
names(Bal_BAA_data)[names(Bal_BAA_data)=="zipcode"] <- "id"
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_roads=shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
p
locations = data.frame(name=c("Children's Mercy Park"), long = c(-94.823686), lat = c(39.121296) )
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_roads=shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
source('~/heatmapR/Template_heatmapR_step2_20161205.R')
p
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_roads=shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
p<-create_map(data=Bal_BAA_data, shape_boundaries=shape_zcta, shape_roads=shape_us_roads,boundaries_coords=zcta, map_center,  dist_center, locations, legend_title, zoom, color_bins, FALSE)
locations = data.frame(name=c("CANADIAN TIRE CENTRE"), long = c(-75.925902), lat = c(45.296034) )
p<-create_map(data=BAA_data, shape_boundaries=shape_boundaries, shape_roads=shape_roads,boundaries_coords=boundaries_coords, map_center,  dist_center, locations, legend_title, zoom, color_bins, TRUE)
